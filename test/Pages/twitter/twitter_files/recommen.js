$(function(){var C=parseInt(($(".profile-user .user").attr("id")||"0").replace("user_",""));function B(D){if(C){$.extend(D,{to_user_id:C})}return D}function A(){(new ShortNotification()).setMessage(_("Whoops! Something went wrong. Please try again!")).show()}$("#recommended_users li div.avatar a, #recommended_users li .screen-name a").live("click",function(I){var D=$(this),F=D.attr("href"),E=D.closest("li").meta(),H=B({rating:6,recommended_user_id:E.id,token:E.feedback}),G=(I.metaKey||I.which==3);if(!I.metaKey){I.preventDefault()}$.ajax({dataType:"json",type:"post",url:"/find_sources/wtf/send_rating",data:H,complete:function(J){if(!G){window.location.href=F}}});scribe($.extend({event_name:"whotofollow_sidebar_profile_click"},H),"whotofollow")});$("#recommended_users li .next-suggestion").live("click",function(H){var G=$(this).closest("li");var E=G.meta();var F=B({rating:5,recommended_user_id:E.id,token:E.feedback});scribe($.extend({event_name:"whotofollow_sidebar_block"},F),"whotofollow");var D=$(".follow-link a",G);if(!G.hasClass("following")){$.ajax({dataType:"json",type:"post",url:"/find_sources/wtf/send_rating",data:F,success:function(I){if(!I||I.status<0){A()}},error:function(){A()}})}data_arr=[];$("#recommended_users li").each(function(){data_arr.push($(this).meta().id)});data_arr=data_arr.join(",");$.ajax({dataType:"text",type:"post",url:"/find_sources/wtf/show_next_recommendation",data:B({excluded:data_arr}),beforeSend:function(){G.animate({opacity:0},300)},success:function(I){if(!I.trim()){A();G.css({opacity:1});return }var J=$(I);J.css({opacity:0});G.replaceWith(J);J.animate({opacity:1},300)},error:function(){A();G.css({opacity:1})}});return false});$("#recommended_users li p.follow-link a").live("click",function(I){I.preventDefault();var D=$(this);if(D.hasClass("loading")){return false}var H=D.closest("li");var E=H.meta();var F=H.hasClass("following");var G=B({rating:1,recommended_user_id:E.id,token:E.feedback});if(!F){$.ajax({dataType:"json",type:"post",url:"/find_sources/wtf/send_rating",data:G})}scribe($.extend({event_name:"whotofollow_sidebar_follow"},G),"whotofollow");$.ajax({dataType:"json",type:"post",url:"/friendships/"+(F?"destroy":"create")+"/"+E.id,beforeSend:function(){D.text(_("Working..."));D.addClass("loading")},success:function(J){H.toggleClass("following");if(H.hasClass("protected")){D.replaceWith('<span class="pending">'+_("Pending")+"</span>")}else{D.text(F?_("Follow"):_("Unfollow"))}},complete:function(){D.removeClass("loading")},error:function(J){A();D.html(F?_("Unfollow"):_("Follow"))}});return false})});